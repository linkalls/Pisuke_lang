# Pisuke Web Server (`std/webserver`) 機能ロードマップ

このドキュメントは、Pisukeの標準ライブラリとして計画されている`std/webserver`モジュールの機能、現状、および将来的な実装計画について概説します。

## 1. コンセプト

Pisukeの`std/webserver`は、Go言語の`net/http`パッケージの堅牢性とパフォーマンスを基盤としつつ、[Hono](https://hono.dev/)のようなモダンなWebフレームワークにインスパイアされた、シンプルで直感的なAPIを提供することを目指します。開発者は最小限のコードで、高速かつ安全なWebアプリケーションやAPIサーバーを構築できるようになります。

## 2. 現状

**未実装 (Not Implemented)**

現在、`std/webserver`モジュールの実装には着手していません。以下の機能はすべて計画段階のものです。

## 3. 計画中の主要機能

仕様書に基づき、以下のAPIを主要な機能として計画しています。

### サーバーの起動とルーティング

```pisuke
// webserverモジュールをインポート
import { server } from "std/webserver"

// ルーティングの設定
// ハンドラ関数はリクエスト(req)を受け取り、レスポンスとして文字列やオブジェクトを返す
server.route("/", fn(req) {
    return "ようこそ、Pisukeの世界へ！"
})

server.route("/users/:id", fn(req) {
    let user_id = req.params.id
    return { id: user_id, name: "サンプルユーザー" } // JSONレスポンスになる
})

// サーバーをポート8080で起動
server.serve(port: 8080)
```

- **`server.serve(port: int)`**: 指定されたポートでHTTPサーバーを起動します。
- **`server.route(path: string, handler: fn)`**: 特定のパスとHTTPメソッド（将来的にサポート）に対応するハンドラ関数を登録します。
  - パスパラメータ（例: `:id`）をサポートし、`req.params`からアクセス可能にします。

### リクエストオブジェクト (`req`)

ハンドラ関数に渡されるリクエストオブジェクトは、HTTPリクエストに関する情報へのアクセスを提供します。

- **`req.query`**: クエリパラメータ (`/search?q=...`) を格納する`map`。
- **`req.params`**: パスパラメータ (`/users/:id`) を格納する`map`。
- **`req.headers`**: リクエストヘッダーを格納する`map`。
- **`req.body`**: リクエストボディ（例: JSON）をパースした結果。

### レスポンス

ハンドラからの戻り値は、自動的に適切なHTTPレスポンスに変換されます。

- **`string`**: `Content-Type: text/plain` のレスポンスボディになります。
- **`map` / `list`**: `Content-Type: application/json` のJSONレスポンスになります。
- 将来的には、ステータスコードやヘッダーを細かく制御するための`response`オブジェクトの導入も検討します。

## 4. 実装ロードマップ（案）

以下のステップで段階的に実装を進めることを提案します。

- **ステップ1: 基本的なHTTPサーバーと静的ルーティング**
  - `server.serve` を実装し、Goの`net/http`サーバーを起動できるようにする。
  - `server.route` を実装し、単純な文字列パス（例: `/`, `/about`）にハンドラを登録できるようにする。
  - ハンドラが文字列を返す機能を実装する。

- **ステップ2: 動的ルーティングとリクエスト情報の拡充**
  - パスパラメータ（例: `/users/:id`）を解析するルーターを実装する。
  - `req.params` と `req.query` からパラメータを取得できるようにする。

- **ステップ3: JSONレスポンスとリクエストボディ**
  - ハンドラが `map` や `list` を返した場合に、自動でJSONにシリアライズしてレスポンスする機能を実装する。
  - POSTリクエストなどで送信されたJSONボディをパースし、`req.body`からアクセスできるようにする。

- **ステップ4: ミドルウェアのサポート**
  - ロギングや認証など、複数のルートで共通の処理を挟み込めるミドルウェアの仕組みを導入する。
  - `server.use(handler: fn)` のようなAPIを検討する。

このロードマップは現時点での案であり、コミュニティからのフィードバックや開発の進捗に応じて変更される可能性があります。
